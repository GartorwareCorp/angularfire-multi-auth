angular.module("angularfire-multi-auth",["firebase"]),function(){"use strict";angular.module("angularfire-multi-auth").config(["$provide",function(a){a.decorator("$firebaseAuth",["$delegate","$q","$window","FBURL_ALTERNATE",function(a,b,c,d){var e=a;return a=function(f){function g(){v=new q(f),u=e(f),w={$createUser:u.$createUser,$removeUser:u.$removeUser,$authWithPassword:u.$authWithPassword,$authWithOAuthPopup:u.$authWithOAuthPopup,$authWithOAuthToken:u.$authWithOAuthToken,$authAnonymously:u.$authAnonymously},u.$createUser=h,u.$removeUser=i,u.$authWithPassword=j,u.$authWithOAuthPopup=k,u.$authWithOAuthToken=l,u.$authAnonymously=m,u.$associateSocial=n,u.$disassociateSocial=o,u.$associatePassword=p}function h(a){var c=b.defer();return w.$createUser(a).then(function(b){w.$authWithPassword(a).then(function(a){r(a,function(){u.$unauth(),c.resolve(b)})})["catch"](function(a){c.reject(a)})})["catch"](function(a){c.reject(a)}),c.promise}function i(a){var c=b.defer();return w.$authWithPassword(a).then(function(b){var d=new Firebase(f.root()+"/authGroup");d.orderByChild(b.provider).equalTo(b.uid).on("child_added",function(b){b.ref().remove(function(b){b?c.reject(b):(u.$unauth(),w.$removeUser(a).then(function(){c.resolve()})["catch"](function(a){c.reject(a)}))})})})["catch"](function(a){c.reject(a)}),c.promise}function j(a,c){var d=b.defer();return w.$authWithPassword(a,c).then(function(a){s(a,d)})["catch"](function(a){d.reject(a)}),d.promise}function k(a,c){var d=b.defer();return w.$authWithOAuthPopup(a,c).then(function(a){s(a,d)})["catch"](function(a){d.reject(a)}),d.promise}function l(a,c,d){var e=b.defer();return w.$authWithOAuthToken(a,c,d).then(function(a){s(a,e)})["catch"](function(a){e.reject(a)}),e.promise}function m(a){var c=b.defer(),d=u.$getAuth();if(d){var e=new Firebase(f.root()+"/authGroup/"+d.authGroup);e.orderByKey().equalTo("anonymous").once("value",function(b){var e=null!==b.val();"anonymous"===d.provider||e?c.resolve(d):t(a,c)})}else t(a,c);return c.promise}function n(c,e){var g=b.defer(),h=new Firebase(d),i=a(h),j=u.$getAuth(),k=function(a){var b=new Firebase(f.root()+"/userMapping/"+a.uid);b.once("value",function(b){var c=null!==b.val();if(c)g.reject("You are already associated to another account");else{var d=new Firebase(f.root()+"/authGroup/"+j.authGroup),e={};e[a.provider]=a.uid,d.update(e,function(){var b=new Firebase(f.root()+"/userMapping"),c={};c[a.uid]=j.authGroup,b.update(c,function(){i.$unauth(),g.resolve(a)})})}})},l=new Firebase(f.root()+"/authGroup/"+j.authGroup);return l.orderByKey().equalTo(c).once("value",function(a){c===j.provider||null!==a.val()?g.reject("You are already using a "+c+" account."):e?i.$authWithOAuthPopup(c).then(function(a){k(a)})["catch"](function(a){g.reject(a)}):i.authWithOAuthToken(c,e).then(function(a){k(a)})["catch"](function(a){g.reject(a)})}),g.promise}function o(a,c){var d=b.defer(),e=u.$getAuth();if(a===e.uid)d.reject("The account you want to disassociate is the logged on user, please logoff and login with another account");else{var g=new Firebase(f.root()+"/userMapping/"+a);g.remove(function(a){if(a)d.reject(a);else{var b=new Firebase(f.root()+"/authGroup/"+e.authGroup+"/"+c);b.remove(function(a){a?d.reject(a):d.resolve()})}})}return d.promise}function p(a){var c=b.defer(),d=u.$getAuth(),e=new Firebase(f.root()+"/authGroup/"+d.authGroup);return e.orderByKey().equalTo("password").once("value",function(b){var e=null!==b.val();"password"===d.provider||e?c.reject("You are already  using a password account."):w.$createUser(a).then(function(b){var e=new Firebase(f.root()+"/userMapping/"+b.uid);e.once("value",function(e){var g=null!==e.val();if(g)c.reject("the email is already associated with another account");else{var h=new Firebase(f.root()+"/users/"+d.authGroup);h.update({email:a.email});var i=new Firebase(f.root()+"/authGroup/"+d.authGroup),j={};j.password=b.uid,i.update(j,function(){var a=new Firebase(f.root()+"/userMapping"),e={};e[b.uid]=d.authGroup,a.update(e,function(){c.resolve(b)})})}})})["catch"](function(a){c.reject(a)})}),c.promise}function q(a){function b(){return JSON.parse(c.localStorage.getItem(h))}function d(a){c.localStorage.setItem(h,JSON.stringify(a))}function e(a){var b;return b=a.indexOf("://")>-1?a.split("/")[2]:a.split("/")[0],b=b.split(":")[0]}function f(a){return a.split(".firebaseio.com")[0]}var g=f(e(a.root().toString())),h="firebase:session::"+g,i={get:b,set:d};return i}function r(a,b){var c=new Firebase(f.root()+"/authGroup"),d={};d[a.provider]=a.uid;var e=c.push(d,function(){var c=new Firebase(f.root()+"/userMapping"),d={};d[a.uid]=e.key(),c.update(d).then(function(){b(e)})});return a}function s(a,b){var c=v.get(),d=new Firebase(f.root()+"/userMapping/"+a.uid);d.once("value",function(d){var e=null!==d.val();return e?(c.authGroup=d.val(),a.authGroup=d.val(),v.set(c),b.resolve(a)):r(a,function(d){c.authGroup=d.key(),a.authGroup=d.key(),v.set(c),b.resolve(a)}),a})}function t(a,b){w.$authAnonymously(a).then(function(a){s(a,b)})["catch"](function(a){b.reject(a)})}var u,v,w;return g(),u}}])}])}();